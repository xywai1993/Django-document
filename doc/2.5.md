# 2.5 编写你第一个 Django 应用，第三部分

[官网链接](https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/)

该教程开始于教程 2 的结尾。我们继续 web 投票程序，并专注于创建公开的界面——“views”

---

**哪里获取帮助**

如果在阅读本教程遇到困难，请移步常见问题的“获得帮助”部分

---

## 2.5.1 概览

“view” 是你 django 应用程序 web 页面的一种类型，通常是服务一种特定的功能，并且拥有特定的模板。比如，在 blog 程序中，你可能需要有如下视图：

-   博客首页——显示一些最新的博文
-   “详情”页面入口——连接到单个项目的页面
-   以年为单位的归档页——展示选中的年份里各个月份创建的内容
-   以月为单位的归档页——展示选中月份里每天的创建的内容
-   以天为单位的归档页——展示选中天里的创建的内容
-   评论操作——处理给定条目响应评论的操作

在我们的投票程序中，我们需要如下视图：

-   问题首页——显示最新的问题
-   问题详情页——显示问题文案，没有结果，只有投票表单
-   问题结果页——显示某个投票的结果
-   投票操作——处理特定问题特定选项的投票操作

在 django 中，web 页面和其他内容的由 views(视图)提供。每个视图由 python 函数表示（在某些类视图中，由方法去表示）。django 通过检查请求的 url 选择视图（更准确的说，是域名后面的 url 部分）

平常你上网可能会遇到像这样的"漂亮"的 ME2/Sites/dirmod.htm?sid=&type=gen&mod=Core+Pages&gid=A6CD4967199A42D9B65B1B url。不久你就会很开心的知道 django 允许我们写出比这更优雅的 url。

URL 模式是 URL 的一般形式——举个栗子：/newsarchive/\<year\>/\<month\>/

为了关联 URL 和 view，Django 使用‘URLconfs’来配置。URLconf 映射 URL 模式 到视图。该教程提供基本的指令来配置 URLconfs，你可与参考 [URL dispatcher]() 来获取更多信息

## 编写更多的视图

让我们添加一些视图到 polls/views.py。这些视图稍微有些不同，因为他们有一些参数：

Listing 16: polls/views.py

```python
def detail(request, question_id):
    return HttpResponse("You're looking at question %s." % question_id)

def results(request, question_id):
    response = "You're looking at the results of question %s."
    return HttpResponse(response % question_id)

def vote(request, question_id):
    return HttpResponse("You're voting on question %s." % question_id)
```

通过添加如下的 path()方法把这些新的视图写进 polls.urls 模块

Listing 17: polls/urls.py

```python
from django.urls import path
from . import views

urlpatterns = [
    # ex: /polls/
    path('', views.index, name='index'),
    # ex: /polls/5/
    path('<int:question_id>/', views.detail, name='detail'),
    # ex: /polls/5/results/
    path('<int:question_id>/results/', views.results, name='results'),
    # ex: /polls/5/vote/
    path('<int:question_id>/vote/', views.vote, name='vote'),
]
```

打开你的浏览器输入/polls/34/ 看一看，它将运行 detail()方法，显示你 url 里面的 34 这个 id， 同样试试“/polls/34/results/” 和 “/polls/34/vote/”——他们将显示占位结果页 和投票页面。

当某人从你的站点内请求一个页面——例如：“/polls/34/”，Django 将加载 mysite.urls Python 模块，因为该项在 ROOT_URLCONF 配置了，它将查找名为 urlpatterns 的变量并按顺序匹配正则表达式，在匹配到了’polls/‘后，将剥离匹配到的文本（“polls/”）然后发送剩余的文本（34/）到 ’polls.urls‘ URLconf 进行后续的匹配。

’34/’将匹配到 '\<int:question_id\>/'，匹配结果将被 detail()作为参数调用：

```python
detail(request=<HttpRequest object>, question_id=34)
```

question_id=34 部分来自 \<int:question_id\> 。使用尖括号”捕获“URL 的部分，并发送捕获到的数据作为关键字参数到视图方法。
":question_id\>"这部分字符串被定义为可以区分匹配正则的一个名字，”\<int:“ 这部分是一个转换器用来决定用什么类型数据来匹配 URL 路径。

## 2.5.3 写一个真正的视图

每个视图的响应至少做二者其一：返回一个包含请求页面内容的 HttpResponse 对象 或者 抛出一个错误（例如 HTTP404）.其他想干的随你便。

你的视图可以读取数据库记录，也可以不读。你可以使用模板系统，比如 Django 的或者第三方 Python 模板系统，也可以不用模板系统。还可以生成 PDF 文件，输出 XML，创建 ZIP 文件，做任何你能想到事，使用任何你想使用的 Python 库。

django 只要求返回 HttpResponse 或者一个错误。

因为这是很方便的事，在教程 2 ，我们使用 Django 的数据库 api。这里我们在 index()视图里试试，显示系统里最新的 5 个投票问题，按照发布日期用逗号分割。

Listing 18: polls/views.py

```python
from django.http import HttpResponse
from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    output = ', '.join([q.question_text for q in latest_question_list])
    return HttpResponse(output)
# Leave the rest of the views (detail, results, vote) unchanged
```

这儿有个问题，页面的设计被硬编码在视图里，将如你想改变页面的展示方式，你必须编辑 Python 代码。所以我们使用 Django 的模板系统分离设计，只需创建一个模板。

首先，你在你的 polls 目录创建一个名为 templates 的目录，Django 将从这里查找模板。

项目的 TEMPLATES 配置描述了 Django 如何加载和渲染模板。默认的配置文件配置 DjangoTemplates 后台的 APP_DIRS 为 True。通常，DjangoTemplates 从 每个 INSTALLED_APPS 里查找“templates”子目录

在刚刚创建的 templates 目录中，创建 polls 目录，在 polls 目录中在创建 index.html 目录。那么，你的模板目录应该是 polls/templates/polls/index.html。因为`app_directories` 模板加载器是通过上述描述的方法运行的，所以 Django 可以引用到 polls/index.html 这一模板了。
